var lumin=function(){'use strict';var a=Math.max;class b{constructor(a){this._root=a,this._resolve=null}_initializeOverlay(){if(!this._overlay){this._overlay=this._root.ownerDocument.createElement('div');const a=this._overlay.style;a.position='absolute',a.top=0,a.bottom=0,a.left=0,a.right=0,a.pointerEvents='none',a.userSelect='none',this._root.appendChild(this._overlay)}}_createInsNode(){const a=this._root.ownerDocument.createElement('ins'),b=a.style;return b.textDecoration='none',b.color='var(--lumin-color, currentColor)',b.background='var(--lumin-background-color, yellow)',a}_createBufferNode(){const a=this._root.ownerDocument.createElement('ins'),b=a.style;return b.textDecoration='none',b.color='transparent',b.opacity=0,a}_reset(){this._initializeOverlay(),this.stop(),this._map=[],this._charCount=0;const a=this._root.childNodes;for(let b=0;b<a.length;b++)a[b]!=this._overlay&&this._process(this._overlay,a[b])}_process(b,c){if(c.nodeType===Node.TEXT_NODE){const d=c.cloneNode(!1);d.textContent='';const e=c.textContent,f=this._createInsNode(),g=this._createBufferNode();f.appendChild(d),g.textContent=e,b.appendChild(f),b.appendChild(g);const h=e.length?a(e.trim().length,1):0;this._map.push({node:d,buffer:g,text:e,length:h,current:''}),this._charCount+=h}else if(c.nodeType===Node.ELEMENT_NODE){const a=c.cloneNode(!1);b.appendChild(a);const d=c.childNodes;if(d&&d.length)for(let b=0;b<d.length;b++)this._process(a,d[b])}}stop(){this._timer&&(clearTimeout(this._timer),delete this._timer)}clear(){this._overlay&&(this._root.removeChild(this._overlay),this._overlay=null)}start(a){return delete this._prevValue,this._overlay||this._reset(),this._charCount||(this._charCount=1),this._interval=a/this._charCount,this._cursor=0,new Promise(a=>{this._resolve=a,this._nextTick()})}_nextTick(){this._timer=setTimeout(()=>this._tick(),this._interval)}_tick(){if(this._cursor>=this._map.length)return void(this._resolve&&(this._resolve(),this._resolve=null));let a=this._map[this._cursor];const b=a.text.length-a.current.length;0>=b?(this._cursor++,this._tick()):(a.current=a.length?a.text.substring(0,a.current.length+1):a.text,a.node.textContent=a.current,a.buffer.textContent=a.text.substring(a.current.length),this._nextTick())}set progress(b){b=Math.min(100,a(0,b));const c=Math.round(this._charCount*b/100),d=!this._prevValue||this._prevValue>c;d&&this.clear(),this._overlay||this._reset();let e=0;for(const a of this._map){let b=c-e;if(0>=b)break;a.length<b?(a.current=a.text,a.node.textContent=a.current,a.buffer.textContent='',e+=a.length):(a.current=a.text.substring(0,b),a.node.textContent=a.current,a.buffer.textContent=a.text.substring(a.current.length),e+=b)}}}return function(a){return new b(a)}}();
